import React, { createContext, useContext, useMemo, useState } from 'react';

const I18N_KEY = 'sdal_new_lang';

const messages = {
  tr: {
    lang_tr: 'Türkçe',
    lang_en: 'İngilizce',
    lang_de: 'Almanca',
    lang_fr: 'Fransızca',
    nav_feed: 'Akış',
    nav_explore: 'Keşfet',
    nav_following: 'Takip Ettiklerim',
    nav_groups: 'Gruplar',
    nav_messages: 'Mesajlar',
    nav_photos: 'Fotoğraflar',
    nav_games: 'Oyunlar',
    nav_events: 'Etkinlikler',
    nav_announcements: 'Duyurular',
    nav_profile: 'Profil',
    nav_help: 'Yardım',
    nav_admin: 'Yönetim',
    nav_notifications: 'Bildirimler',
    profile_preview_members: 'Profilim nasıl görünüyor?',
    follow: 'Takip Et',
    unfollow: 'Takibi Bırak',
    all_notifications: 'Tüm Bildirimleri Gör',
    see_all: 'Tümünü Gör',
    online_members: 'Çevrimiçi Üyeler',
    popular: 'Popüler',
    all: 'Tümü',
    following: 'Takip Ettiklerim',
    advanced_format: 'Gelişmiş Biçimlendirme',
    formatting: 'Biçimlendirme',
    help_engagement: 'Etkileşim Skoru Yardımı',
    post_placeholder: 'Bugün neler oluyor?',
    post_share: 'Paylaş',
    comment_placeholder: 'Yorum yaz...',
    send: 'Gönder',
    no_comments_yet: 'Henüz yorum yok.',
    filter_none: 'Filtre Yok',
    filter_grayscale: 'Siyah Beyaz',
    filter_sepia: 'Sepya',
    filter_vivid: 'Canlı',
    filter_cool: 'Soğuk',
    filter_warm: 'Sıcak',
    filter_blur: 'Blur',
    filter_sharp: 'Sharp',
    translate_button: 'Çevir',
    translate_loading: 'Çevriliyor...',
    show_original: 'Orijinali Göster',
    translate_failed: 'Çeviri başarısız.',
    rt_undo: 'Geri Al',
    rt_redo: 'Yinele',
    rt_font_size: 'Yazı boyutu',
    rt_color: 'Renk',
    rt_align_left: 'Sola hizala',
    rt_align_center: 'Ortala',
    rt_align_right: 'Sağa hizala',
    rt_align_justify: 'İki yana yasla',
    rt_bullet_list: 'Madde listesi',
    rt_numbered_list: 'Numaralı liste',
    rt_quote: 'Alıntı',
    rt_clear_format: 'Biçimlendirmeyi temizle',
    rt_clear: 'Temizle'
  },
  en: {
    lang_tr: 'Turkish',
    lang_en: 'English',
    lang_de: 'German',
    lang_fr: 'French',
    nav_feed: 'Feed',
    nav_explore: 'Explore',
    nav_following: 'Following',
    nav_groups: 'Groups',
    nav_messages: 'Messages',
    nav_photos: 'Photos',
    nav_games: 'Games',
    nav_events: 'Events',
    nav_announcements: 'Announcements',
    nav_profile: 'Profile',
    nav_help: 'Help',
    nav_admin: 'Admin',
    nav_notifications: 'Notifications',
    profile_preview_members: 'How my profile appears?',
    follow: 'Follow',
    unfollow: 'Unfollow',
    all_notifications: 'View All Notifications',
    see_all: 'See All',
    online_members: 'Online Members',
    popular: 'Popular',
    all: 'All',
    following: 'Following',
    advanced_format: 'Advanced Formatting',
    formatting: 'Formatting',
    help_engagement: 'Engagement Score Help',
    post_placeholder: "What's happening today?",
    post_share: 'Share',
    comment_placeholder: 'Write a comment...',
    send: 'Send',
    no_comments_yet: 'No comments yet.',
    filter_none: 'No Filter',
    filter_grayscale: 'Grayscale',
    filter_sepia: 'Sepia',
    filter_vivid: 'Vivid',
    filter_cool: 'Cool',
    filter_warm: 'Warm',
    filter_blur: 'Blur',
    filter_sharp: 'Sharp',
    translate_button: 'Translate',
    translate_loading: 'Translating...',
    show_original: 'Show Original',
    translate_failed: 'Translation failed.',
    rt_undo: 'Undo',
    rt_redo: 'Redo',
    rt_font_size: 'Font size',
    rt_color: 'Color',
    rt_align_left: 'Align left',
    rt_align_center: 'Align center',
    rt_align_right: 'Align right',
    rt_align_justify: 'Justify',
    rt_bullet_list: 'Bullet list',
    rt_numbered_list: 'Numbered list',
    rt_quote: 'Quote',
    rt_clear_format: 'Clear formatting',
    rt_clear: 'Clear'
  },
  de: {
    lang_tr: 'Türkisch',
    lang_en: 'Englisch',
    lang_de: 'Deutsch',
    lang_fr: 'Französisch',
    nav_feed: 'Feed',
    nav_explore: 'Entdecken',
    nav_following: 'Gefolgte',
    nav_groups: 'Gruppen',
    nav_messages: 'Nachrichten',
    nav_photos: 'Fotos',
    nav_games: 'Spiele',
    nav_events: 'Veranstaltungen',
    nav_announcements: 'Ankündigungen',
    nav_profile: 'Profil',
    nav_help: 'Hilfe',
    nav_admin: 'Verwaltung',
    nav_notifications: 'Benachrichtigungen',
    profile_preview_members: 'Wie sieht mein Profil aus?',
    follow: 'Folgen',
    unfollow: 'Entfolgen',
    all_notifications: 'Alle Benachrichtigungen',
    see_all: 'Alle anzeigen',
    online_members: 'Online-Mitglieder',
    popular: 'Beliebt',
    all: 'Alle',
    following: 'Gefolgte',
    advanced_format: 'Erweiterte Formatierung',
    formatting: 'Formatierung',
    help_engagement: 'Hilfe zum Interaktionswert',
    post_placeholder: 'Was passiert heute?',
    post_share: 'Teilen',
    comment_placeholder: 'Kommentar schreiben...',
    send: 'Senden',
    no_comments_yet: 'Noch keine Kommentare.',
    filter_none: 'Kein Filter',
    filter_grayscale: 'Graustufen',
    filter_sepia: 'Sepia',
    filter_vivid: 'Lebhaft',
    filter_cool: 'Kühl',
    filter_warm: 'Warm',
    filter_blur: 'Weichzeichnen',
    filter_sharp: 'Scharf',
    translate_button: 'Übersetzen',
    translate_loading: 'Wird übersetzt...',
    show_original: 'Original anzeigen',
    translate_failed: 'Übersetzung fehlgeschlagen.',
    rt_undo: 'Rückgängig',
    rt_redo: 'Wiederholen',
    rt_font_size: 'Schriftgröße',
    rt_color: 'Farbe',
    rt_align_left: 'Linksbündig',
    rt_align_center: 'Zentriert',
    rt_align_right: 'Rechtsbündig',
    rt_align_justify: 'Blocksatz',
    rt_bullet_list: 'Aufzählung',
    rt_numbered_list: 'Nummerierte Liste',
    rt_quote: 'Zitat',
    rt_clear_format: 'Formatierung entfernen',
    rt_clear: 'Löschen'
  },
  fr: {
    lang_tr: 'Turc',
    lang_en: 'Anglais',
    lang_de: 'Allemand',
    lang_fr: 'Français',
    nav_feed: 'Fil',
    nav_explore: 'Explorer',
    nav_following: 'Abonnements',
    nav_groups: 'Groupes',
    nav_messages: 'Messages',
    nav_photos: 'Photos',
    nav_games: 'Jeux',
    nav_events: 'Événements',
    nav_announcements: 'Annonces',
    nav_profile: 'Profil',
    nav_help: 'Aide',
    nav_admin: 'Administration',
    nav_notifications: 'Notifications',
    profile_preview_members: 'Comment mon profil apparaît ?',
    follow: 'Suivre',
    unfollow: 'Ne plus suivre',
    all_notifications: 'Voir toutes les notifications',
    see_all: 'Voir tout',
    online_members: 'Membres en ligne',
    popular: 'Populaire',
    all: 'Tout',
    following: 'Abonnements',
    advanced_format: 'Mise en forme avancée',
    formatting: 'Mise en forme',
    help_engagement: "Aide score d'engagement",
    post_placeholder: "Quoi de neuf aujourd'hui ?",
    post_share: 'Publier',
    comment_placeholder: 'Écrire un commentaire...',
    send: 'Envoyer',
    no_comments_yet: 'Aucun commentaire pour le moment.',
    filter_none: 'Sans filtre',
    filter_grayscale: 'Niveaux de gris',
    filter_sepia: 'Sépia',
    filter_vivid: 'Vif',
    filter_cool: 'Froid',
    filter_warm: 'Chaud',
    filter_blur: 'Flou',
    filter_sharp: 'Net',
    translate_button: 'Traduire',
    translate_loading: 'Traduction...',
    show_original: "Voir l'original",
    translate_failed: 'Échec de la traduction.',
    rt_undo: 'Annuler',
    rt_redo: 'Rétablir',
    rt_font_size: 'Taille de police',
    rt_color: 'Couleur',
    rt_align_left: 'Aligner à gauche',
    rt_align_center: 'Centrer',
    rt_align_right: 'Aligner à droite',
    rt_align_justify: 'Justifier',
    rt_bullet_list: 'Liste à puces',
    rt_numbered_list: 'Liste numérotée',
    rt_quote: 'Citation',
    rt_clear_format: 'Effacer la mise en forme',
    rt_clear: 'Effacer'
  }
};

const I18nContext = createContext({
  lang: 'tr',
  setLang: () => {},
  t: (key) => key
});

function readInitialLang() {
  if (typeof window === 'undefined') return 'tr';
  const value = String(window.localStorage.getItem(I18N_KEY) || 'tr').toLowerCase();
  if (['tr', 'en', 'de', 'fr'].includes(value)) return value;
  return 'tr';
}

export function I18nProvider({ children }) {
  const [lang, setLangState] = useState(() => readInitialLang());

  const setLang = (value) => {
    const next = ['tr', 'en', 'de', 'fr'].includes(value) ? value : 'tr';
    setLangState(next);
    if (typeof window !== 'undefined') {
      window.localStorage.setItem(I18N_KEY, next);
    }
  };

  const t = (key) => messages[lang]?.[key] || messages.tr?.[key] || key;

  const value = useMemo(() => ({ lang, setLang, t }), [lang]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}
